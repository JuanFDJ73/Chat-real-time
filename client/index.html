<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/static/icon.png">
    <title>ChatOp</title>
    <link rel="stylesheet" type="text/css" href="/styles/chat.css">
    <link rel="stylesheet" type="text/css" href="/styles/chatHeader.css">
    <link rel="stylesheet" type="text/css" href="/styles/chatInput.css">
    <link rel="stylesheet" type="text/css" href="/styles/contactButton.css">
    <link rel="stylesheet" type="text/css" href="/styles/contactHeader.css">
    <link rel="stylesheet" type="text/css" href="/styles/indexStyle.css">  
</head>

<body>

    <script type="module">
        import { cleanChat, chatOn, chatOff, cambiarTitulo, changeImgContactHeader, displayMessage, userIdVisibilyOff, switchUserIdVisibility} from '/ui.js';
        import { setCookieUser, cleanCookieContact, apiVerifyUserId, setCookieContact, apiVerifyContactId, setContacts } from '/api.js';
        import { setupSocketListeners, socket } from '/socket.js';
        import { hiddenWords, scrollToBottom } from '/utils.js';
        import { handleSubmit } from '/forms.js';
        // Capturamos el formulario y el input del mensaje, as√≠ como el contenedor de mensajes.
        const form = document.getElementById('form');
        const messageInput = document.getElementById('message');
        const messageContainer = document.getElementById('message-container');

        // Llamar a la funci√≥n al cargar la p√°gina
        window.onload = function() {
            setCookieUser();
            cleanCookieContact();
            setContacts();
            userIdVisibilyOff()
            chatOff();
        };
        //Inicializacion del socket
        setupSocketListeners(socket, displayMessage, scrollToBottom);
        handleSubmit(socket);

        document.getElementById("back").addEventListener("click", function() {
            cleanChat();
            cleanCookieContact();
            cambiarTitulo("ChatOp");
            chatOff();
            changeImgContactHeader("/static/perfil.png");         
        })

        document.getElementById("toggleVisibilityButton").addEventListener("click", switchUserIdVisibility);

    </script>

    <section id="menu-container" class="menu-container">
            <!-- Dise√±o en modo prueba -->
        <div id="user-id-container" class="user-id-container">
            <div id="user" class="user">
                <div id="user-contact" class="user-contact">
                    <h4 id="userIdContent" data-visible="false">UserId: </h4>
                </div>
                <button id="toggleVisibilityButton">üëÅÔ∏è</button>
            </div>
        </div>
        <div id="contacts" class="contacts">
            <!-- Contactos aparecer√°n aqu√≠ -->
            <!-- <button class="contacts-menu">contacto</button>  Contacto ejemplo-->
        </div>
    </section>

    <section id="chat">
        <div id="contact-container" class="contact-container">
            <button id="back" class="back">
                <img src="/static/back.png" alt="">
            </button>
            <div id="icon-container" class="icon">
                <img src="/static/perfil.png" alt="icono">
            </div>
            <div id="nombre-contact" class="nombre-contact">
                <h1>ChatOp</h1>
            </div>

        </div>
        <div id="message-container" class="message-container">
            <!-- Los mensajes aparecer√°n aqu√≠ -->
        </div>
        <form id="form">
            <input type="text" name="message" id="message" placeholder="Escribe un mensaje" />
            <button type="submit">Enviar</button>
        </form>
    </section>

</body>

</html>